<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Clustering | Spatial data analysis</title>
  <meta name="description" content="Chapter 4 Clustering | Spatial data analysis" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Clustering | Spatial data analysis" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Clustering | Spatial data analysis" />
  
  
  

<meta name="author" content="Saif Shabou" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="computation-of-indicators.html"/>
<link rel="next" href="supervised-classifcation.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-exploration.html"><a href="data-exploration.html"><i class="fa fa-check"></i><b>2</b> Data exploration</a><ul>
<li class="chapter" data-level="2.1" data-path="data-exploration.html"><a href="data-exploration.html#get-remote-sensing-data"><i class="fa fa-check"></i><b>2.1</b> Get remote sensing data</a></li>
<li class="chapter" data-level="2.2" data-path="data-exploration.html"><a href="data-exploration.html#data-visualization"><i class="fa fa-check"></i><b>2.2</b> Data visualization</a></li>
<li class="chapter" data-level="2.3" data-path="data-exploration.html"><a href="data-exploration.html#subset-and-rename-bands"><i class="fa fa-check"></i><b>2.3</b> Subset and rename bands</a><ul>
<li class="chapter" data-level="2.3.1" data-path="data-exploration.html"><a href="data-exploration.html#load-all-the-layers"><i class="fa fa-check"></i><b>2.3.1</b> load all the layers</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-exploration.html"><a href="data-exploration.html#spatial-subset"><i class="fa fa-check"></i><b>2.3.2</b> Spatial subset</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="data-exploration.html"><a href="data-exploration.html#spectral-profiles"><i class="fa fa-check"></i><b>2.4</b> Spectral profiles</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="computation-of-indicators.html"><a href="computation-of-indicators.html"><i class="fa fa-check"></i><b>3</b> Computation of indicators</a><ul>
<li class="chapter" data-level="3.1" data-path="computation-of-indicators.html"><a href="computation-of-indicators.html#ndvi-index"><i class="fa fa-check"></i><b>3.1</b> NDVI Index</a></li>
<li class="chapter" data-level="3.2" data-path="computation-of-indicators.html"><a href="computation-of-indicators.html#principal-component-analysis"><i class="fa fa-check"></i><b>3.2</b> Principal Component Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>4</b> Clustering</a></li>
<li class="chapter" data-level="5" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html"><i class="fa fa-check"></i><b>5</b> Supervised Classifcation</a><ul>
<li class="chapter" data-level="5.1" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#reference-data"><i class="fa fa-check"></i><b>5.1</b> Reference data</a></li>
<li class="chapter" data-level="5.2" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#generate-sample-sites"><i class="fa fa-check"></i><b>5.2</b> Generate sample sites</a></li>
<li class="chapter" data-level="5.3" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#extract-values-for-sites"><i class="fa fa-check"></i><b>5.3</b> Extract values for sites</a></li>
<li class="chapter" data-level="5.4" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#train-the-classifier"><i class="fa fa-check"></i><b>5.4</b> Train the classifier</a></li>
<li class="chapter" data-level="5.5" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#classify"><i class="fa fa-check"></i><b>5.5</b> Classify</a></li>
<li class="chapter" data-level="5.6" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#model-evaluation"><i class="fa fa-check"></i><b>5.6</b> Model Evaluation</a><ul>
<li class="chapter" data-level="5.6.1" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>5.6.1</b> K-fold cross validation</a></li>
<li class="chapter" data-level="5.6.2" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#overall-accuracy"><i class="fa fa-check"></i><b>5.6.2</b> Overall accuracy</a></li>
<li class="chapter" data-level="5.6.3" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#kappa-statistic"><i class="fa fa-check"></i><b>5.6.3</b> Kappa statistic</a></li>
<li class="chapter" data-level="5.6.4" data-path="supervised-classifcation.html"><a href="supervised-classifcation.html#producer-and-user-accuracy"><i class="fa fa-check"></i><b>5.6.4</b> Producer and user accuracy</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatial data analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="clustering" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Clustering</h1>
<p>For this example, we will follow the National Land Cover Database 2011 (NLCD 2011) classification scheme for a subset of the Central Valley regions. We use cloud-free composite image from Landsat 5 with 6 bands</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" title="1">landsat5 &lt;-<span class="st"> </span><span class="kw">stack</span>(<span class="st">&#39;data/rs/centralvalley-2011LT5.tif&#39;</span>)</a>
<a class="sourceLine" id="cb36-2" title="2"><span class="kw">names</span>(landsat5) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;blue&#39;</span>, <span class="st">&#39;green&#39;</span>, <span class="st">&#39;red&#39;</span>, <span class="st">&#39;NIR&#39;</span>, <span class="st">&#39;SWIR1&#39;</span>, <span class="st">&#39;SWIR2&#39;</span>)</a></code></pre></div>
<p>We will use the k-means algorithm to group pixels with similar spectral characteristics.
We perform the unsupervised clsutering on a subset of the ndvi layer.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" title="1"><span class="co"># first we compute the ndvi layer</span></a>
<a class="sourceLine" id="cb37-2" title="2">ndvi &lt;-<span class="st"> </span>(landsat5[[<span class="st">&#39;NIR&#39;</span>]] <span class="op">-</span><span class="st"> </span>landsat5[[<span class="st">&#39;red&#39;</span>]]) <span class="op">/</span><span class="st"> </span>(landsat5[[<span class="st">&#39;NIR&#39;</span>]] <span class="op">+</span><span class="st"> </span>landsat5[[<span class="st">&#39;red&#39;</span>]])</a></code></pre></div>
<p>Then we get raster values from a spatial subset of the ndvi layer</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" title="1"><span class="co"># Extent to crop ndvi layer</span></a>
<a class="sourceLine" id="cb38-2" title="2">e &lt;-<span class="st"> </span><span class="kw">extent</span>(<span class="op">-</span><span class="fl">121.807</span>, <span class="fl">-121.725</span>, <span class="fl">38.004</span>, <span class="fl">38.072</span>)</a>
<a class="sourceLine" id="cb38-3" title="3"><span class="co"># crop landsat by the extent</span></a>
<a class="sourceLine" id="cb38-4" title="4">ndvi &lt;-<span class="st"> </span><span class="kw">crop</span>(ndvi, e)</a>
<a class="sourceLine" id="cb38-5" title="5">ndvi</a></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 252, 304, 76608  (nrow, ncol, ncell)
## resolution : 0.0002694946, 0.0002694946  (x, y)
## extent     : -121.807, -121.725, 38.00413, 38.07204  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : memory
## names      : layer 
## values     : -0.3360085, 0.7756007  (min, max)</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" title="1"><span class="co"># convert the raster to vecor/matrix</span></a>
<a class="sourceLine" id="cb40-2" title="2">nr &lt;-<span class="st"> </span><span class="kw">getValues</span>(ndvi)</a>
<a class="sourceLine" id="cb40-3" title="3"><span class="kw">str</span>(nr)</a></code></pre></div>
<pre><code>##  num [1:76608] 0.245 0.236 0.272 0.277 0.277 ...</code></pre>
<p>Now we perform the kmeans clustering on the matrix and inspect the output</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" title="1"><span class="co"># It is important to set the seed generator because `kmeans` initiates the centers in random locations</span></a>
<a class="sourceLine" id="cb42-2" title="2"><span class="kw">set.seed</span>(<span class="dv">99</span>)</a>
<a class="sourceLine" id="cb42-3" title="3"><span class="co"># We want to create 10 clusters, allow 500 iterations, start with 5 random sets using &quot;Lloyd&quot; method</span></a>
<a class="sourceLine" id="cb42-4" title="4">kmncluster &lt;-<span class="st"> </span><span class="kw">kmeans</span>(<span class="kw">na.omit</span>(nr), <span class="dt">centers =</span> <span class="dv">10</span>, <span class="dt">iter.max =</span> <span class="dv">500</span>, <span class="dt">nstart =</span> <span class="dv">5</span>, <span class="dt">algorithm=</span><span class="st">&quot;Lloyd&quot;</span>)</a>
<a class="sourceLine" id="cb42-5" title="5"><span class="co"># kmeans returns an object of class &quot;kmeans&quot;</span></a>
<a class="sourceLine" id="cb42-6" title="6"><span class="kw">str</span>(kmncluster)</a></code></pre></div>
<pre><code>## List of 9
##  $ cluster     : int [1:76608] 4 4 3 3 3 3 3 4 4 4 ...
##  $ centers     : num [1:10, 1] 0.55425 0.00498 0.29997 0.20892 -0.20902 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : chr [1:10] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. ..$ : NULL
##  $ totss       : num 6459
##  $ withinss    : num [1:10] 5.69 6.13 4.91 4.9 5.75 ...
##  $ tot.withinss: num 55.8
##  $ betweenss   : num 6403
##  $ size        : int [1:10] 8932 4550 7156 6807 11672 8624 8736 5040 9893 5198
##  $ iter        : int 108
##  $ ifault      : NULL
##  - attr(*, &quot;class&quot;)= chr &quot;kmeans&quot;</code></pre>
<p>Kmeans returns an object of 9 elements. The cell values of kmncluster$cluster range between 1 to 10 corresponding to the input number of cluster we provided. It indicates the cluster label for corresponding pixel. We need to convert theses labels to RasterLayer of the same dimension of the ndvi.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" title="1"><span class="co"># Use the ndvi object to set the cluster values to a new raster</span></a>
<a class="sourceLine" id="cb44-2" title="2">knr &lt;-<span class="st"> </span><span class="kw">setValues</span>(ndvi, kmncluster<span class="op">$</span>cluster)</a>
<a class="sourceLine" id="cb44-3" title="3">knr</a></code></pre></div>
<pre><code>## class      : RasterLayer 
## dimensions : 252, 304, 76608  (nrow, ncol, ncell)
## resolution : 0.0002694946, 0.0002694946  (x, y)
## extent     : -121.807, -121.725, 38.00413, 38.07204  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
## source     : memory
## names      : layer 
## values     : 1, 10  (min, max)</code></pre>
<p>The resulting knr Ratsrer layer contains pixels with their corresponding cluster labels. We will plor the clustering raster layer with the original raster image side by side in order to recognize the land cover classes for each cluster.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" title="1"><span class="co"># Use the ndvi object to set the cluster values to a new raster</span></a>
<a class="sourceLine" id="cb46-2" title="2"><span class="co"># Define a color vector for 10 clusters (learn more about setting the color later)</span></a>
<a class="sourceLine" id="cb46-3" title="3">mycolor &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#fef65b&quot;</span>,<span class="st">&quot;#ff0000&quot;</span>, <span class="st">&quot;#daa520&quot;</span>,<span class="st">&quot;#0000ff&quot;</span>,<span class="st">&quot;#0000ff&quot;</span>,<span class="st">&quot;#00ff00&quot;</span>,<span class="st">&quot;#cbbeb5&quot;</span>,</a>
<a class="sourceLine" id="cb46-4" title="4">             <span class="st">&quot;#c3ff5b&quot;</span>, <span class="st">&quot;#ff7373&quot;</span>, <span class="st">&quot;#00ff00&quot;</span>, <span class="st">&quot;#808080&quot;</span>)</a>
<a class="sourceLine" id="cb46-5" title="5"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb46-6" title="6"><span class="kw">plot</span>(ndvi, <span class="dt">col =</span> <span class="kw">rev</span>(<span class="kw">terrain.colors</span>(<span class="dv">10</span>)), <span class="dt">main =</span> <span class="st">&#39;Landsat-NDVI&#39;</span>)</a>
<a class="sourceLine" id="cb46-7" title="7"><span class="kw">plot</span>(knr, <span class="dt">main =</span> <span class="st">&#39;Unsupervised classification&#39;</span>, <span class="dt">col =</span> mycolor )</a></code></pre></div>
<p><img src="bookdown-demo_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="computation-of-indicators.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="supervised-classifcation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
